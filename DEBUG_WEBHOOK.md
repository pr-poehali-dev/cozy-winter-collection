# üîç –û—Ç–ª–∞–¥–∫–∞ Robokassa Webhook

## –ü—Ä–æ–±–ª–µ–º–∞
–ó–∞–∫–∞–∑ #146 –æ–ø–ª–∞—á–µ–Ω, –Ω–æ —Å—Ç–∞—Ç—É—Å –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è –Ω–∞ `paid`, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—à–ª–∏.

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

### 1. Robokassa –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç Result URL
**–ü—Ä–æ–≤–µ—Ä—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
- –ó–∞–π–¥–∏ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç Robokassa
- –û—Ç–∫—Ä–æ–π **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**
- –£–±–µ–¥–∏—Å—å —á—Ç–æ Result URL **–≤–∫–ª—é—á–µ–Ω** (–≥–∞–ª–æ—á–∫–∞)
- URL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å: `https://functions.poehali.dev/5420828a-4f2b-45e0-908f-6d59922e7791`
- –ú–µ—Ç–æ–¥: **POST** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### 2. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Robokassa
–í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ Robokassa –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞–∑–¥–µ–ª —Å –ª–æ–≥–∞–º–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.
–¢–∞–º –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å:
- –û—Ç–ø—Ä–∞–≤–ª—è–ª—Å—è –ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–∞ Result URL
- –ö–∞–∫–æ–π —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—É—á–µ–Ω (200 OK / –æ—à–∏–±–∫–∞)
- –¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ –±—ã–ª–∞

### 3. –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º
–ï—Å–ª–∏ –º–∞–≥–∞–∑–∏–Ω –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ, —É–±–µ–¥–∏—Å—å —á—Ç–æ:
- –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —É–∫–∞–∑–∞–Ω **—Ç–µ—Å—Ç–æ–≤—ã–π Result URL** (–º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **—Ç–µ—Å—Ç–æ–≤—ã–π –ü–∞—Ä–æ–ª—å #2**

## –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ webhook

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ Robokassa
–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã Robokassa –¥–æ–ª–∂–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
```
OutSum=1000.00
InvId=12345
SignatureValue=ABC123DEF456...
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å –ø–æ–¥–ø–∏—Å—å –≤—Ä—É—á–Ω—É—é
–§–æ—Ä–º—É–ª–∞ –ø–æ–¥–ø–∏—Å–∏ –¥–ª—è Result URL:
```
MD5(OutSum:InvId:ROBOKASSA_PASSWORD_2)
```

–ü—Ä–∏–º–µ—Ä:
- OutSum = 1000.00
- InvId = 146 (ID –∑–∞–∫–∞–∑–∞ –≤ Robokassa)
- Password2 = —Ç–≤–æ–π_–ø–∞—Ä–æ–ª—å_2

–ü–æ–¥–ø–∏—Å—å:
```
MD5("1000.00:146:—Ç–≤–æ–π_–ø–∞—Ä–æ–ª—å_2") ‚Üí –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä
```

### –®–∞–≥ 3: –†—É—á–Ω–æ–π –≤—ã–∑–æ–≤ webhook –¥–ª—è —Ç–µ—Å—Ç–∞
–ú–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å webhook –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ curl (–∑–∞–º–µ–Ω–∏ –∑–Ω–∞—á–µ–Ω–∏—è):

```bash
curl -X POST "https://functions.poehali.dev/5420828a-4f2b-45e0-908f-6d59922e7791" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "OutSum=1000.00&InvId=146&SignatureValue=–¢–í–û–Ø_–ü–û–î–ü–ò–°–¨_–ó–î–ï–°–¨"
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: `OK146`

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–≤–µ—Ä—å –µ—Å—Ç—å –ª–∏ –∑–∞–∫–∞–∑ 146 –≤ –ë–î:
```sql
SELECT id, order_number, robokassa_inv_id, status, total 
FROM t_p3876556_cozy_winter_collecti.orders 
WHERE id = 146;
```

**–í–∞–∂–Ω–æ:** `robokassa_inv_id` –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å `InvId` –∏–∑ Robokassa!

### –ï—Å–ª–∏ robokassa_inv_id –ø—É—Å—Ç–æ–π –∏–ª–∏ NULL:
–≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –∑–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–ª–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è InvId –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–ø–ª–∞—Ç—É.

## –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û–±–Ω–æ–≤–∏ —Å—Ç–∞—Ç—É—Å –≤—Ä—É—á–Ω—É—é
–ï—Å–ª–∏ –∑–∞–∫–∞–∑ —Ç–æ—á–Ω–æ –æ–ø–ª–∞—á–µ–Ω, –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤ –±–∞–∑–µ:

```sql
UPDATE t_p3876556_cozy_winter_collecti.orders 
SET status = 'paid', paid_at = CURRENT_TIMESTAMP 
WHERE id = 146;
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π –∑–∞–∫–∞–∑
–ï—Å–ª–∏ —ç—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑:
1. –£–¥–∞–ª–∏ —Å—Ç–∞—Ä—ã–π –∑–∞–∫–∞–∑
2. –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑ –Ω–∞ —Å–∞–π—Ç–µ
3. –û–ø–ª–∞—Ç–∏ —á–µ—Ä–µ–∑ Robokassa
4. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ webhook'–∞

## –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å

1. ‚úÖ Result URL –≤–∫–ª—é—á–µ–Ω –≤ Robokassa?
2. ‚úÖ URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π? `https://functions.poehali.dev/5420828a-4f2b-45e0-908f-6d59922e7791`
3. ‚úÖ –ü–∞—Ä–æ–ª—å #2 —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å–µ–∫—Ä–µ—Ç—ã?
4. ‚úÖ –ï—Å—Ç—å –ª–∏ –∑–∞–∫–∞–∑ 146 –≤ –±–∞–∑–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º `robokassa_inv_id`?
5. ‚úÖ –ï—Å—Ç—å –ª–∏ –∑–∞–ø–∏—Å–∏ –≤ –ª–æ–≥–∞—Ö Robokassa –æ–± –æ—Ç–ø—Ä–∞–≤–∫–µ Result URL?

## –õ–æ–≥–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

–õ–æ–≥–∏ webhook'–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ç–æ–ª—å–∫–æ –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç—ã (—É—Å—Ç–∞–Ω–æ–≤–∫—É —Ñ—É–Ω–∫—Ü–∏–∏).
**–ù–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç Robokassa** ‚Äî —ç—Ç–æ –∑–Ω–∞—á–∏—Ç:
- –õ–∏–±–æ Result URL –Ω–µ –≤–∫–ª—é—á–µ–Ω
- –õ–∏–±–æ Robokassa –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ –¥—Ä—É–≥–æ–π URL
- –õ–∏–±–æ —ç—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥—Ä—É–≥–æ–π URL

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü—Ä–æ–≤–µ—Ä—å –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç Robokassa** ‚Äî —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ!
2. –û—Ç–∫—Ä–æ–π —Ä–∞–∑–¥–µ–ª —Å –ª–æ–≥–∞–º–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ Result URL
3. –ù–∞–π–¥–∏ –∑–∞–ø–∏—Å—å –¥–ª—è –∑–∞–∫–∞–∑–∞ #146
4. –ü–æ—Å–º–æ—Ç—Ä–∏ —á—Ç–æ —Ç–∞–º –Ω–∞–ø–∏—Å–∞–Ω–æ (—É—Å–ø–µ—Ö / –æ—à–∏–±–∫–∞)
5. –°–¥–µ–ª–∞–π —Å–∫—Ä–∏–Ω—à–æ—Ç –∏ –ø–æ–∫–∞–∂–∏ –º–Ω–µ

–ï—Å–ª–∏ –≤ Robokassa –Ω–µ—Ç –ª–æ–≥–æ–≤ –≤–æ–æ–±—â–µ ‚Üí –∑–Ω–∞—á–∏—Ç Result URL –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏–ª–∏ –≤—ã–∫–ª—é—á–µ–Ω.
